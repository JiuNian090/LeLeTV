# 任务文档

<!-- AI指令：对于每个任务，生成一个_Prompt字段，包含结构化AI指导，格式如下：
_Prompt: 角色: [专业开发角色] | 任务: [清晰的任务描述和上下文引用] | 限制: [不要做什么，约束条件] | 成功: [具体完成标准]
这有助于提供比简单"处理此任务"提示更好的AI代理指导。 -->

- [ ] 1. 优化图片懒加载实现
  - 文件: js/lazy-loading.js
  - 增强IntersectionObserver配置以获得更好性能
  - 为关键图片添加预加载
  - 目的: 减少初始页面加载时间并改善感知性能
  - _复用: js/lazy-loading.js中的现有LazyLoader类_
  - _需求: 1.1, 1.2_
  - _Prompt: 角色: 专注于图像优化和懒加载的前端性能工程师 | 任务: 根据需求1.1和1.2增强js/lazy-loading.js中的现有LazyLoader实现，通过优化IntersectionObserver配置和为关键图片添加预加载来提升性能 | 限制: 不要破坏现有功能，保持向后兼容性，遵循现有代码模式 | 成功: 图片通过改进的IntersectionObserver设置加载更快，关键图片有效预加载，页面加载时间减少_

- [ ] 2. 实现视频内容资源预加载
  - 文件: js/player.js
  - 添加视频源预加载逻辑
  - 实现下一集的预测性预加载
  - 目的: 减少视频启动时间并改善用户体验
  - _复用: 现有的player.js实现和API_SITES配置_
  - _需求: 1.3, 2.1_
  - _Prompt: 角色: 专注于媒体优化的视频流性能工程师 | 任务: 根据需求1.3和2.1在player.js中实现视频内容资源预加载，添加视频源预加载逻辑和下一集的预测性预加载 | 限制: 不要过度占用网络资源，尊重用户带宽，实现适当的错误处理 | 成功: 视频启动时间减少，下一集有效预加载，用户体验在不占用过多资源的情况下得到改善_

- [ ] 3. 优化API请求管理
  - 文件: js/loadBalancer.js
  - 使用性能指标增强负载均衡算法
  - 实现请求优先级排序和排队
  - 目的: 改善API响应时间并减少失败
  - _复用: js/loadBalancer.js中的现有LoadBalancer类_
  - _需求: 2.2, 2.3_
  - _Prompt: 角色: 专注于API优化和负载均衡的后端性能工程师 | 任务: 根据需求2.2和2.3增强js/loadBalancer.js中的LoadBalancer类，通过性能指标改进负载均衡算法并实现请求优先级排序和排队 | 限制: 不要破坏现有API集成，保持与所有API源的兼容性，确保公平的负载分配 | 成功: API响应时间改善，请求失败减少，负载均衡更加智能和高效_

- [ ] 4. 实现智能缓存策略
  - 文件: js/cache-manager.js
  - 添加多级缓存和不同的TTL策略
  - 为频繁访问的资源实现缓存预热
  - 目的: 减少冗余请求并改善加载时间
  - _复用: js/cache-manager.js中的现有CacheManager_
  - _需求: 1.1, 3.1_
  - _Prompt: 角色: 专注于缓存策略的系统性能工程师 | 任务: 根据需求1.1和3.1增强js/cache-manager.js中的CacheManager，通过多级缓存和不同的TTL策略以及为频繁访问的资源实现缓存预热 | 限制: 不要超出localStorage配额，保持数据一致性，尊重用户隐私 | 成功: 冗余请求减少，加载时间改善，缓存命中率提高_

- [ ] 5. 优化页面转换性能
  - 文件: js/watch.js
  - 实现页面状态缓存和恢复
  - 添加转换动画和加载指示器
  - 目的: 创建更流畅的页面间导航
  - _复用: 现有的watch.js和player.js实现_
  - _需求: 1.1, 1.3_
  - _Prompt: 角色: 专注于导航优化的前端性能工程师 | 任务: 根据需求1.1和1.3在watch.js中优化页面转换，通过实现页面状态缓存/恢复和添加转换动画/加载指示器 | 限制: 不要显著增加内存使用，保持向后兼容性，确保流畅动画 | 成功: 页面转换更流畅，导航期间状态得以保留，加载指示器提供清晰反馈_

- [ ] 6. 实现性能监控和分析
  - 文件: js/performance-monitor.js (新)
  - 创建性能指标收集系统
  - 添加以用户为中心的性能测量
  - 目的: 跟踪优化效果并识别瓶颈
  - _复用: Navigation Timing API, Resource Timing API_
  - _需求: 3.2, 3.3_
  - _Prompt: 角色: 专注于Web性能指标的性能分析师 | 任务: 根据需求3.2和3.3创建新的js/performance-monitor.js性能监控系统，使用Navigation Timing和Resource Timing API收集指标并测量以用户为中心的性能 | 限制: 监控时不要影响页面性能，尊重用户隐私，高效存储数据 | 成功: 性能指标准确收集，有效测量用户体验，可识别和解决瓶颈_

- [ ] 7. 优化CSS和JavaScript交付
  - 文件: css/*.css, js/*.js
  - 为非关键资源实现代码分割
  - 使用关键路径CSS优化CSS交付
  - 目的: 减少初始负载并改善渲染时间
  - _复用: 现有的CSS和JS文件，构建过程_
  - _需求: 1.1, 3.1_
  - _Prompt: 角色: 专注于资源优化的前端性能工程师 | 任务: 根据需求1.1和3.1优化css/*.css和js/*.js文件中的CSS和JavaScript交付，通过代码分割和关键路径CSS实现 | 限制: 不要破坏现有功能，保持跨浏览器兼容性，确保所有功能正常工作 | 成功: 初始负载减少，渲染时间改善，非关键资源异步加载_

- [ ] 8. 为高级缓存实现service worker
  - 文件: service-worker.js
  - 增强service worker缓存策略
  - 为关键资源添加离线支持
  - 目的: 改善重复访问和离线体验
  - _复用: 现有的service-worker.js实现_
  - _需求: 3.1, 3.3_
  - _Prompt: 角色: 专注于service worker的渐进式Web应用工程师 | 任务: 根据需求3.1和3.3增强service-worker.js中的service worker，通过实现高级缓存策略和为关键资源添加离线支持 | 限制: 不要缓存敏感用户数据，确保缓存更新正常工作，保持与现有功能的兼容性 | 成功: 通过改进的缓存重复访问更快，关键资源离线工作，用户体验增强_

- [ ] 9. 优化视频播放器初始化
  - 文件: js/player.js
  - 延迟非关键播放器初始化
  - 为播放器功能实现渐进式增强
  - 目的: 减少播放器加载时间并改善响应性
  - _复用: 现有的ArtPlayer实现_
  - _需求: 2.1, 2.3_
  - _Prompt: 角色: 专注于媒体框架的视频播放器性能工程师 | 任务: 根据需求2.1和2.3在player.js中优化视频播放器初始化，通过延迟非关键初始化和实现渐进式增强 | 限制: 不要破坏播放器功能，保持所有现有功能，确保流畅播放 | 成功: 播放器加载时间减少，响应性改善，所有功能正常工作_

- [ ] 10. 进行性能测试和验证
  - 文件: tests/performance/*.test.js (新)
  - 创建性能基准测试
  - 验证优化与基线测量的对比
  - 目的: 确保优化提供可衡量的改进
  - _复用: 现有的测试基础设施_
  - _需求: 全部_
  - _Prompt: 角色: 专注于基准测试和测试的QA性能工程师 | 任务: 在tests/performance/*.test.js中创建性能测试，覆盖所有需求，通过实现基准测试和验证优化与基线测量的对比 | 限制: 测试必须可重复和可靠，不要创建人为的性能瓶颈，确保测试在CI/CD中运行 | 成功: 性能改进可衡量，优化得到验证，回归测试防止性能下降_